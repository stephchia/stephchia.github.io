<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Pairwise beta diversity tutorial | Stephanie Chia </title> <meta name="author" content="Stephanie Chia"> <meta name="description" content="A tutorial explaining concept of Marion et al.'s (2017) pairwise beta diversity (with R)"> <meta name="keywords" content="ecoinformatics, ecology, evolution, macroecology, macroevolution, ecologist, phd, data science, environment"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Klee+One&amp;family=LXGW+WenKai+TC&amp;family=Yuji+Boku&amp;display=swap" rel="stylesheet"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://stephchia.github.io/blog/2021/pairwise-beta/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Stephanie Chia <span class="zh">賈媛</span> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/research/">Research </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Pairwise beta diversity tutorial</h1> <p class="post-meta"> Created on October 26, 2021 </p> <p class="post-tags"> <a href="/blog/2021"> <i class="fa-solid fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/r"> <i class="fa-solid fa-hashtag fa-sm"></i> R</a>   <a href="/blog/tag/community"> <i class="fa-solid fa-hashtag fa-sm"></i> community</a>   <a href="/blog/tag/biodiversity"> <i class="fa-solid fa-hashtag fa-sm"></i> biodiversity</a>   ·   <a href="/blog/category/teaching"> <i class="fa-solid fa-tag fa-sm"></i> teaching</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>Note: This material was created for leading the discussion in the course Frontiers in Biodiversity Measurement (Fall 2021) at the University of Maryland.</p> </blockquote> <ul> <li>Main reference: <a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecy.1753#support-information-section" rel="external nofollow noopener" target="_blank">Marion et al. (2017) Pairwise beta diversity resolves an underappreciated source of confusion in calculating species turnover.</a> </li> <li>Data source for R tutorial: <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/geb.12822" rel="external nofollow noopener" target="_blank">Harrison et al. (2018) Phylogenetic homogenization of bee communities across ecoregions.</a> </li> </ul> <hr> <h2 id="background">Background</h2> <h3 id="beta-diversity">Beta Diversity</h3> <p>Beta diversity is the degree of differentiation among biological communities.</p> <p><img src="/assets/img/post/20211026/01.png" alt="image" width="60%"></p> <h6 id="image-adapted-from-tamilnadu-board-12th-class-biology-textbook">Image adapted from <a href="https://cdn1.byjus.com/wp-content/uploads/2019/04/Tamilnadu-Board-Class-12-Zoology-Chapter-12.pdf" rel="external nofollow noopener" target="_blank">Tamilnadu Board 12th Class Biology textbook</a> </h6> <p>Say $\alpha$ is the species diversity of a community, and $\gamma$ is the total species diversity of a region composed of multiple communities. For a system with $N$ communities, Beta Diversity can be defined as $\beta = \gamma/\alpha$ (<a href="https://doi.org/10.2307/1943563" rel="external nofollow noopener" target="_blank">Whittaker 1960</a>).</p> <p><img src="/assets/img/post/20211026/02.png" alt="image" width="70%"></p> <p>However, as $\beta$ can range from $1$ to $N$, this measure is not comparable between systems with different $N$.</p> <h3 id="turnover-rate">Turnover Rate</h3> <p>Turnover Rate provides a more standardized measure, defined as \(T=\dfrac{\beta-1}{N-1}\) where $T$ ranges from 0 to 1. However, this measure is sensitive to sample size. Let’s look at the following example.</p> <p><img src="/assets/img/post/20211026/03.png" alt="image" width="50%"></p> <p>In this system with 5 communities, if we have a complete sample of all sites:</p> \[N=5,\ \ T=\dfrac{\beta-1}{N-1}=\dfrac{1.25-1}{5-1}=\dfrac{1}{16}\] <p>For incomplete sampling, $T$ can be overestimated:</p> \[N=4,\ \ T=\dfrac{1.25-1}{4-1}=\dfrac{1}{12}\] \[N=3,\ \ T=\dfrac{1.25-1}{3-1}=\dfrac{1}{8}\] \[N=2,\ \ T=\dfrac{1.25-1}{2-1}=\dfrac{1}{4}\] <h3 id="pairwise-dissimilarily">Pairwise Dissimilarily</h3> <p>In order to resolve these problems, Marion et al. (2017) introduced pairwise beta diversity as a unbiased measure of species turnover. This is done by computing the turnover rate for every community pair, and then take the average.</p> <p>Let’s look at the same example as the above, with 5 communities in the system. Every community pair ($N=2$) has a turnover rate: \(N=2,\ \ T=\dfrac{1.25-1}{2-1}=\dfrac{1}{4}\)</p> <p>And then we compute the average of the observed turnover rates $\bar{T}$, which is 1/4. Even when we only sample part of the communities, the measure remains unchanged.</p> <p><img src="/assets/img/post/20211026/04.png" alt="image" width="100%"></p> <p>An intuitive understanding of this measure $\bar{T}=1/4$ is “one out the four species present within a site is not expected to be present in a second site”.</p> <hr> <h2 id="r-tutorial-a-comparison-between-n-community-and-mean-pairwise-dissimilarity-beta-diversity-measures">R tutorial: A comparison between N-community and mean pairwise dissimilarity beta diversity measures</h2> <p>You want to know whether urbanization can lead to ecological homogenization in bee communities. In other words: are bee communities in urban habitats more similar to each other than communities in forests or agricultural lands?</p> <p><img src="/assets/img/post/20211026/05.png" alt="image" width="90%"></p> <p>You plan to collect samples from 12 sites, each with three habitats: agricultural, forest, and urban. That makes 36 community samples in total.</p> <p><img src="/assets/img/post/20211026/06.png" alt="image" width="60%"></p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggmap</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># these are the locations of the blocks</span><span class="w">
</span><span class="n">site</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"site_data.csv"</span><span class="p">)</span><span class="w"> </span><span class="c1"># import sampling site data</span><span class="w">

</span><span class="c1"># take a look at where the 36 locations are</span><span class="w">
</span><span class="n">map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_stamenmap</span><span class="p">(</span><span class="n">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="m">-78.6</span><span class="p">,</span><span class="w"> </span><span class="n">bottom</span><span class="o">=</span><span class="m">38.6</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="o">=</span><span class="m">-73.2</span><span class="p">,</span><span class="w"> </span><span class="n">top</span><span class="o">=</span><span class="m">43</span><span class="p">),</span><span class="w"> </span><span class="n">zoom</span><span class="o">=</span><span class="m">7</span><span class="p">)</span><span class="w">
</span><span class="n">ggmap</span><span class="p">(</span><span class="n">map</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">site</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">lu</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <p>To test the ecological homogenization hypothesis, you want to know whether there is a lower turnover across the urban sites than across non-urban sites. You chose this turnover metric from the literature.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This function computes N-community turnover (based on Marion et al. (2017), q = 1)</span><span class="w">
</span><span class="c1"># The object 'comm' takes in an abundance data frame with sites as rows and species as columns</span><span class="w">
</span><span class="c1"># We use the same function to compute pairwise turnover, in that case 'comm' has only two rows</span><span class="w">
</span><span class="n">turnover</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">pz</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">comm</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span><span class="w">
  </span><span class="n">pg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">colSums</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span><span class="w">
  </span><span class="n">pq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">pz</span><span class="p">)</span><span class="w">
  </span><span class="n">pq</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">pq</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">

  </span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="nf">sum</span><span class="p">(</span><span class="n">colSums</span><span class="p">(</span><span class="n">pq</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">pq</span><span class="p">)))</span><span class="w">
  </span><span class="n">gamma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="nf">sum</span><span class="p">(</span><span class="n">pg</span><span class="p">[</span><span class="n">pg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">pg</span><span class="p">[</span><span class="n">pg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">])))</span><span class="w">
  </span><span class="n">beta</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gamma</span><span class="o">/</span><span class="n">alpha</span><span class="w">

  </span><span class="n">turnover</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">beta</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">turnover</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This function generates pairwise community list</span><span class="w">
</span><span class="c1"># The object 'comm' takes in an abundance data frame with sites as rows and species as columns</span><span class="w">
</span><span class="n">comm.pairs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">target</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">combn</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">comm</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1"># generate all pair combinations</span><span class="w">
  </span><span class="n">pairs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">target</span><span class="p">))</span><span class="w"> </span><span class="n">pairs</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">comm</span><span class="p">[</span><span class="n">target</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">comm</span><span class="p">[</span><span class="n">target</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="p">])</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h3 id="scenario-1">Scenario 1</h3> <p>You’ve successfully collected all 36 samples — phew!!! Now it’s time to prepare and analyze your data.</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># this is the beautiful dataset you've collected</span><span class="w">
</span><span class="n">bee</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"bee_community_data.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="c1"># import community data</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">bee</span><span class="p">)</span><span class="w"> </span><span class="c1"># 36 sites in total</span><span class="w">
</span><span class="n">bee</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">]</span><span class="w"> </span><span class="c1"># check the first few columns of the first few samples</span><span class="w">

</span><span class="c1"># separate the dataset based on habitat types</span><span class="w">
</span><span class="n">ag</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bee</span><span class="p">[</span><span class="n">grepl</span><span class="p">(</span><span class="s2">".ag"</span><span class="p">,</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">bee</span><span class="p">),</span><span class="w"> </span><span class="n">fixed</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="c1"># agriculture</span><span class="w">
</span><span class="n">fo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bee</span><span class="p">[</span><span class="n">grepl</span><span class="p">(</span><span class="s2">".fo"</span><span class="p">,</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">bee</span><span class="p">),</span><span class="w"> </span><span class="n">fixed</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="c1"># forest</span><span class="w">
</span><span class="n">ur</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bee</span><span class="p">[</span><span class="n">grepl</span><span class="p">(</span><span class="s2">".ur"</span><span class="p">,</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">bee</span><span class="p">),</span><span class="w"> </span><span class="n">fixed</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="c1"># urban</span><span class="w">

</span><span class="c1"># check the first few columns of these datasets (there are 12 sites each)</span><span class="w">
</span><span class="n">ag</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w">
</span><span class="n">fo</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w">
</span><span class="n">ur</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]</span><span class="w">
</span></code></pre></div></div> <h4 id="option-1-compute-the-n-community-turnover">Option 1: compute the N-community turnover</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">turnover</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span><span class="w">
</span><span class="n">turnover</span><span class="p">(</span><span class="n">fo</span><span class="p">)</span><span class="w">
</span><span class="n">turnover</span><span class="p">(</span><span class="n">ur</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <ul> <li>Q1: What can you say about the results?</li> </ul> <h4 id="option-2-compute-mean-pairwise-turnover">Option 2: compute mean pairwise turnover</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Start with the agriculture habitats</span><span class="w">
</span><span class="c1"># Step 1: generate a list of all combinations of pairwise community datasets</span><span class="w">
</span><span class="n">pairs.ag</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">comm.pairs</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span><span class="w">
</span><span class="n">pairs.ag</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="c1"># check out how the first community pair looks like</span><span class="w">
</span><span class="nf">length</span><span class="p">(</span><span class="n">pairs.ag</span><span class="p">)</span><span class="w"> </span><span class="c1"># there are 66 elements in the list, each contains a pair of communities</span><span class="w">

</span><span class="c1"># Step 2: compute turnover for each community pair</span><span class="w">
</span><span class="n">turn.ag</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">pairs.ag</span><span class="p">,</span><span class="w"> </span><span class="n">turnover</span><span class="p">)</span><span class="w">
</span><span class="n">turn.ag</span><span class="w"> </span><span class="c1"># there are 66 turnover value for the 66 pairs of communities</span><span class="w">

</span><span class="c1"># Step 3: finally, compute the mean of the pairwise turnover</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="n">turn.ag</span><span class="p">)</span><span class="w">

</span><span class="c1">## Do the same for the forest and urban habitats (and make it shorter)</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">comm.pairs</span><span class="p">(</span><span class="n">fo</span><span class="p">),</span><span class="w"> </span><span class="n">turnover</span><span class="p">))</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">comm.pairs</span><span class="p">(</span><span class="n">ur</span><span class="p">),</span><span class="w"> </span><span class="n">turnover</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <ul> <li>Q2-1: What can you say about the results?</li> <li>Q2-2: Do you reach the same conclusion as the first method?</li> </ul> <p><strong>««««««« TIME REVERSAL «««««««</strong></p> <h3 id="scenario-2">Scenario 2</h3> <p>You’re almost done with sampling — just six urban sites left. Suddenly, your state government closes the state border for pandemic control. You have no choice but to cancel the trips. Worse, there’s no sign the border will reopen soon. You reeeeeally need to wrap up this study to graduate on time. What can you do with incomplete data?</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># these are the samples you have in hand, sorry</span><span class="w">
</span><span class="n">ag</span><span class="w"> </span><span class="c1"># agriculture</span><span class="w">
</span><span class="n">fo</span><span class="w"> </span><span class="c1"># forest</span><span class="w">
</span><span class="n">ur.incomplete</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ur</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="c1"># randomly select 6 sites from the 12 urban sites</span><span class="w">
</span><span class="n">ur.incomplete</span><span class="w">
</span></code></pre></div></div> <h4 id="option-1-go-ahead-and-compute-the-n-community-turnover-anyway">Option 1: Go ahead and compute the N-community turnover anyway</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">turnover</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span><span class="w">
</span><span class="n">turnover</span><span class="p">(</span><span class="n">fo</span><span class="p">)</span><span class="w">
</span><span class="n">turnover</span><span class="p">(</span><span class="n">ur.incomplete</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <ul> <li>Q3-1: What can you say about the results?</li> <li>Q3-2: Do the turnover values change with sample size? (you can try different sample size with <code class="language-plaintext highlighter-rouge">ur[sample(1:12, 'your_sample_size'), ]</code>)</li> </ul> <p>Let’s take one step forward and compute the N-community turnover of the urban samples for different sample sizes</p> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">turn_nc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="o">*</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">turn_nc</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Number_of_sites"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Turnover"</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># try from 2 samples to 12 samples</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># randomly sample for 20 times and compute the turnover each time</span><span class="w">
    </span><span class="n">rs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">turnover</span><span class="p">(</span><span class="n">ur</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="p">])</span><span class="w">
    </span><span class="n">turn_nc</span><span class="p">[(</span><span class="n">i</span><span class="m">-2</span><span class="p">)</span><span class="o">*</span><span class="m">20</span><span class="o">+</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">rs</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">Turnover</span><span class="o">~</span><span class="n">Number_of_sites</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">turn_nc</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <ul> <li>Q3-3: Now, do you trust the results of your turnover measure? Why or why not?</li> </ul> <h4 id="option-2-youve-heard-about-this-average-pairwise-dissimilarity-thing-and-decided-to-give-it-a-try">Option 2: You’ve heard about this Average Pairwise Dissimilarity thing and decided to give it a try</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">comm.pairs</span><span class="p">(</span><span class="n">ag</span><span class="p">),</span><span class="w"> </span><span class="n">turnover</span><span class="p">))</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">comm.pairs</span><span class="p">(</span><span class="n">fo</span><span class="p">),</span><span class="w"> </span><span class="n">turnover</span><span class="p">))</span><span class="w">
</span><span class="n">mean</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">comm.pairs</span><span class="p">(</span><span class="n">ur.incomplete</span><span class="p">),</span><span class="w"> </span><span class="n">turnover</span><span class="p">))</span><span class="w">
</span></code></pre></div></div> <ul> <li>Q4-1: What can you say about the results?</li> <li>Q4-2: Do the turnover values change with sample size?</li> </ul> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># compute the mean pairwise turnover for the urban samples for different sample size</span><span class="w">
</span><span class="c1"># WARNING: this may take up to a few minutes to run</span><span class="w">
</span><span class="n">turn_pw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="o">*</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">turn_pw</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Number_of_sites"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Turnover"</span><span class="p">)</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># try from 2 samples to 12 samples</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># randomly sample for 10 times and compute the turnover each time</span><span class="w">
    </span><span class="n">rs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">comm.pairs</span><span class="p">(</span><span class="n">ur</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="p">]),</span><span class="w"> </span><span class="n">turnover</span><span class="p">))</span><span class="w">
    </span><span class="n">turn_pw</span><span class="p">[(</span><span class="n">i</span><span class="m">-2</span><span class="p">)</span><span class="o">*</span><span class="m">10</span><span class="o">+</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">rs</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">boxplot</span><span class="p">(</span><span class="n">Turnover</span><span class="o">~</span><span class="n">Number_of_sites</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">turn_pw</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <ul> <li>Q4-3: Do you now trust your results? Why or why not?</li> </ul> <h4 id="option-3-how-about-just-discarding-the-sites-without-an-urban-sample">Option 3: how about just discarding the sites without an urban sample</h4> <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># suggest these are the six urban sites you have sampled</span><span class="w">
</span><span class="n">the6sites</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">ur</span><span class="p">),</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w">
</span><span class="n">ur.incomplete</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ur</span><span class="p">[</span><span class="n">the6sites</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1"># select the corresponding samples from the agricultural and forest samples</span><span class="w">
</span><span class="c1"># so that you have equal sample size among habitat types</span><span class="w">
</span><span class="n">ag.incomplete</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ag</span><span class="p">[</span><span class="n">the6sites</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">fo.incomplete</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fo</span><span class="p">[</span><span class="n">the6sites</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1"># you can plot the locations to see what sites you've got</span><span class="w">
</span><span class="n">site.incomplete</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">site</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="n">the6sites</span><span class="o">*</span><span class="m">3-2</span><span class="p">,</span><span class="w"> </span><span class="n">the6sites</span><span class="o">*</span><span class="m">3-1</span><span class="p">,</span><span class="w"> </span><span class="n">the6sites</span><span class="o">*</span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">ggmap</span><span class="p">(</span><span class="n">map</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_point</span><span class="p">(</span><span class="n">site.incomplete</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">lu</span><span class="p">))</span><span class="w">

</span><span class="c1"># compute the N-community turnover</span><span class="w">
</span><span class="n">turnover</span><span class="p">(</span><span class="n">ag.incomplete</span><span class="p">)</span><span class="w">
</span><span class="n">turnover</span><span class="p">(</span><span class="n">fo.incomplete</span><span class="p">)</span><span class="w">
</span><span class="n">turnover</span><span class="p">(</span><span class="n">ur.incomplete</span><span class="p">)</span><span class="w">
</span></code></pre></div></div> <ul> <li>Q5-1: What can you say about the results?</li> <li>Q5-2: Do you trust the results? Why or why not?</li> <li>Q5-3: Is the conclusion consistent if we have different samples? (try run the cold multiple times for the “Option 3” section)</li> <li>Q5-4: Which of the three options do you prefer? Why?</li> </ul> </div> </article> </div> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © 2025 Stephanie Chia. Powered by Jekyll with al-folio theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>