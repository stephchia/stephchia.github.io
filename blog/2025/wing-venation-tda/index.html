<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Exploring insect wing venation with persistent homology | Stephanie Chia </title> <meta name="author" content="Stephanie Chia"> <meta name="description" content="Python workflow for detecting 2D topological structures of insect wings"> <meta name="keywords" content="ecoinformatics, ecology, evolution, macroecology, macroevolution, ecologist, phd, data science, environment"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Klee+One&amp;family=LXGW+WenKai+TC&amp;family=Yuji+Boku&amp;display=swap" rel="stylesheet"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/favicon.png?16a68f269ad8c4b8ec613166def673ad"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://stephchia.github.io/blog/2025/wing-venation-tda/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Stephanie Chia <span class="zh">賈媛</span> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/research/">Research </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Exploring insect wing venation with persistent homology</h1> <p class="post-meta"> Created on July 01, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/tda"> <i class="fa-solid fa-hashtag fa-sm"></i> TDA</a>   <a href="/blog/tag/python"> <i class="fa-solid fa-hashtag fa-sm"></i> Python</a>   <a href="/blog/tag/morphology"> <i class="fa-solid fa-hashtag fa-sm"></i> morphology</a>   <a href="/blog/tag/insect"> <i class="fa-solid fa-hashtag fa-sm"></i> insect</a>   ·   <a href="/blog/category/workflow"> <i class="fa-solid fa-tag fa-sm"></i> workflow</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>Code &amp; Notebook on <a href="https://github.com/stephchia/wing-venation-tda" rel="external nofollow noopener" target="_blank">GitHub</a></p> </blockquote> <p>This post walks through a Python pipeline for analyzing insect wing venation using persistent homology, a tool from topological data analysis (TDA). By preprocessing wing images into 2D point clouds, we can detect loop structures in the venation using TDA. I demonstrate the method using wing images from a dragonfly, cicada, and grasshopper, and briefly discuss how their structural patterns are shown in persistence diagrams.</p> <p><img src="/assets/img/post/20250701/01.jpg" alt="wing1" width="40%"> <img src="/assets/img/post/20250701/02.jpg" alt="wing2" width="15%"> <img src="/assets/img/post/20250701/03.jpg" alt="wing3" width="25%"></p> <h6 id="wing-photo-source-dragonfly-cicada-grasshopper">Wing photo source: <a href="https://www.istockphoto.com/photo/macro-of-a-cordulegaster-bidentatas-wings-isolated-on-white-gm465101125-32958098" rel="external nofollow noopener" target="_blank">Dragonfly</a>, <a href="https://www.istockphoto.com/photo/isolated-cicada-or-fairy-wings-gm177017600-19789568" rel="external nofollow noopener" target="_blank">Cicada</a>, <a href="https://www.shutterstock.com/image-photo/wings-migratory-locust-locusta-migratoria-isolated-497422774" rel="external nofollow noopener" target="_blank">Grasshopper</a> </h6> <hr> <h2 id="procedure">Procedure</h2> <p>Outline:</p> <ul> <li>Use <em>scikit-image</em> to preprocess images</li> <li>Use <em>scikit-TDA</em> (<em>ripser.py</em> and <em>persim</em>) for topological data analysis</li> </ul> <h3 id="1-process-images">1. Process images</h3> <p>Let’s use a forewing of dragonfly as the example. The image preprocessing includes the following steps:</p> <ol> <li>Load image in grayscale</li> <li>Denoise</li> <li>Convert to binary image</li> <li>Skeletonize</li> <li>Make into point cloud</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="n">skimage</span> <span class="kn">import</span> <span class="n">io</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">morphology</span>
<span class="kn">from</span> <span class="n">skimage.restoration</span> <span class="kn">import</span> <span class="n">denoise_bilateral</span>
<span class="kn">from</span> <span class="n">skimage.filters</span> <span class="kn">import</span> <span class="n">threshold_local</span>
<span class="kn">from</span> <span class="n">skimage.morphology</span> <span class="kn">import</span> <span class="n">skeletonize</span>
</code></pre></div></div> <h4 id="11-load-image-in-grayscale">1.1 Load image in grayscale</h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">img</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="nf">imread</span><span class="p">(</span><span class="sh">"</span><span class="s">wing_dragonfly.jpg</span><span class="sh">"</span><span class="p">,</span> <span class="n">as_gray</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/post/20250701/04.png" alt="image" width="80%"></p> <h4 id="12-denoise">1.2 Denoise</h4> <p>The printed image might not look much different before and after denoising, but it does clean out some dots within the venation windows later in the binary image, which would likely make some difference in TDA results.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">img_denoise</span> <span class="o">=</span> <span class="nf">denoise_bilateral</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">sigma_color</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">sigma_spatial</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/post/20250701/05.png" alt="image" width="80%"></p> <h4 id="13-convert-to-binary-image">1.3 Convert to binary image</h4> <p>Instead of using a fixed global threshold (which may fail under uneven lighting), we apply <strong>local thresholding</strong>, which adapts based on the pixel’s neighborhood. The local threshold is computed as the weighted mean of surrounding pixels (set by <code class="language-plaintext highlighter-rouge">block_size</code>), minus a constant (<code class="language-plaintext highlighter-rouge">offset</code>).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">local_thresh</span> <span class="o">=</span> <span class="nf">threshold_local</span><span class="p">(</span><span class="n">img_denoise</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="p">.</span><span class="mi">001</span><span class="p">)</span>
<span class="n">img_binary</span> <span class="o">=</span> <span class="n">img_denoise</span> <span class="o">&lt;</span> <span class="n">local_thresh</span>
</code></pre></div></div> <p><img src="/assets/img/post/20250701/06.png" alt="image" width="80%"></p> <h4 id="14-skeletonize">1.4 Skeletonize</h4> <p>Skeletonization reduces each vein to a 1-pixel-wide path, preserving the structure while greatly reducing the number of points.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">img_skeleton</span> <span class="o">=</span> <span class="nf">skeletonize</span><span class="p">(</span><span class="n">img_binary</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/post/20250701/07.png" alt="image" width="80%"></p> <h4 id="15-convert-to-point-cloud">1.5 Convert to point cloud</h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get coordinates of all foreground pixels (vein areas)
</span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">column_stack</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">nonzero</span><span class="p">(</span><span class="n">img_skeleton</span><span class="p">))</span>  <span class="c1"># shape: (N, 2)
</span></code></pre></div></div> <p><img src="/assets/img/post/20250701/08.png" alt="image" width="80%"></p> <h4 id="16-subsampling">1.6 Subsampling</h4> <p>Subsampling reduces computational cost in TDA, but there’s a trade-off: too few points may miss topological features, while too many increase runtime. Choose <code class="language-plaintext highlighter-rouge">n_sample</code> based on dataset size and analysis goals.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">n_sample</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">points_sampled</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</code></pre></div></div> <p><img src="/assets/img/post/20250701/09.png" alt="image" width="80%"></p> <h3 id="2-topological-data-analysis-tda">2. Topological data analysis (TDA)</h3> <p>We use <strong>persistent homology</strong> to identify loop-like structures in the wing’s point cloud. Specifically, we apply a <strong>Vietoris–Rips filtration</strong> to extract H0 (connected components) and H1 (loops). For background, see <a href="https://www.youtube.com/watch?v=h0bnG1Wavag" rel="external nofollow noopener" target="_blank">intro video on TDA</a> by Matthew Wright.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">ripser</span> <span class="kn">import</span> <span class="n">ripser</span>
<span class="kn">from</span> <span class="n">persim</span> <span class="kn">import</span> <span class="n">plot_diagrams</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Rips filtration
</span><span class="n">result</span> <span class="o">=</span> <span class="nf">ripser</span><span class="p">(</span><span class="n">points_sampled</span><span class="p">,</span> <span class="n">maxdim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># setting maxdim=1 would detect H0 and H1 features
</span><span class="n">diagrams</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">dgms</span><span class="sh">"</span><span class="p">]</span>

<span class="c1"># Plot persistent diagram
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="nf">plot_diagrams</span><span class="p">(</span><span class="n">diagrams</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">lifetime</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/post/20250701/10.png" alt="image" width="50%"></p> <p>The output persistent diagram shows each detected loops in orange dot (H1), with more “significant” features (those with longer lifespan across distance threshold) locating higher up in y axis, while the less significant or noise features lower down at the bottom. From the results, I suppose the highest two orange points represent the big windows at the top left of the wing.</p> <h3 id="applying-the-workflow-to-other-insect-wings">Applying the workflow to other insect wings</h3> <p>Now I apply the same procedure to process two additional wing images.</p> <h4 id="grasshopper-hindwing">Grasshopper (hindwing)</h4> <ul> <li>Image processing</li> </ul> <p><img src="/assets/img/post/20250701/11.png" alt="image" width="100%"></p> <ul> <li>Persistence digram</li> </ul> <p><img src="/assets/img/post/20250701/12.png" alt="image" width="50%"></p> <h4 id="cicade-forewing">Cicade (forewing)</h4> <ul> <li>Image processing</li> </ul> <p><img src="/assets/img/post/20250701/13.png" alt="image" width="70%"></p> <ul> <li>Persistence digram</li> </ul> <p><img src="/assets/img/post/20250701/14.png" alt="image" width="50%"></p> <p>The 15 orange dots higher up in the persistence diagram likely correspond to the 15 distinct windows in the cicada forewing. The dots near the bottom may represent noise or small structures near the wing base.</p> <hr> <h2 id="refleciton">Refleciton</h2> <ul> <li>Point sampling density significantly affects the persistence diagram, especially the Birth values of H1 features. Choosing the sampling level is a trade-off between computational efficiency and topological fidelity. <ul> <li>In densely sampled images (e.g. cicada), true loop structures (wing windows) tend to appear as a vertical line of H1 points with low Birth values but varying Lifetime. Those with higher Birth values are likely to represent noise.</li> <li>In contrast, sparser sampling spreads H1 features more broadly across the birth axis (e.g. grasshopper), making it harder to distinguish true biological structures from noise.</li> </ul> </li> <li>In this particular case of analyzing wing venation with TDA, the actual venation information is probably mostly captured in the lifetime of H1 features (distribution along the y-axis), whereas the birth axis reflect point sampling density and information about how likely the signals are noise.</li> </ul> </div> </article> </div> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © 2025 Stephanie Chia. Powered by Jekyll with al-folio theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>